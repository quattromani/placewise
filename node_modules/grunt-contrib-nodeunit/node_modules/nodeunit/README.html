<!DOCTYPE  html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>doc</title>
    <style>
      /*github.com style (c) Vasily Polovnyov <vast@whiteants.net>*/
      pre code {
        display: block; padding: 0.5em;
        color: #333;
        background: #f8f8ff
      }
      pre .comment,
      pre .template_comment,
      pre .diff .header,
      pre .javadoc {
        color: #998;
        font-style: italic
      }
      pre .keyword,
      pre .css .rule .keyword,
      pre .winutils,
      pre .javascript .title,
      pre .nginx .title,
      pre .subst,
      pre .request,
      pre .status {
        color: #333;
        font-weight: bold
      }
      pre .number,
      pre .hexcolor,
      pre .ruby .constant {
        color: #099;
      }
      pre .string,
      pre .tag .value,
      pre .phpdoc,
      pre .tex .formula {
        color: #d14
      }
      pre .title,
      pre .id {
        color: #900;
        font-weight: bold
      }
      pre .javascript .title,
      pre .lisp .title,
      pre .clojure .title,
      pre .subst {
        font-weight: normal
      }
      pre .class .title,
      pre .haskell .type,
      pre .vhdl .literal,
      pre .tex .command {
        color: #458;
        font-weight: bold
      }
      pre .tag,
      pre .tag .title,
      pre .rules .property,
      pre .django .tag .keyword {
        color: #000080;
        font-weight: normal
      }
      pre .attribute,
      pre .variable,
      pre .lisp .body {
        color: #008080
      }
      pre .regexp {
        color: #009926
      }
      pre .class {
        color: #458;
        font-weight: bold
      }
      pre .symbol,
      pre .ruby .symbol .string,
      pre .lisp .keyword,
      pre .tex .special,
      pre .prompt {
        color: #990073
      }
      pre .built_in,
      pre .lisp .title,
      pre .clojure .built_in {
        color: #0086b3
      }
      pre .preprocessor,
      pre .pi,
      pre .doctype,
      pre .shebang,
      pre .cdata {
        color: #999;
        font-weight: bold
      }
      pre .deletion {
        background: #fdd
      }
      pre .addition {
        background: #dfd
      }
      pre .diff .change {
        background: #0086b3
      }
      pre .chunk {
        color: #aaa
      }
    </style>
  </head>
  <body>  
    <h1 id="nodeunit">Nodeunit</h1>
<p>Simple syntax, powerful tools. Nodeunit provides easy async unit testing for
node.js and the browser.</p>
<ul>
<li>Simple to use</li>
<li>Just export the tests from a module</li>
<li>Works with node.js and in the browser</li>
<li>Helps you avoid common pitfalls when testing asynchronous code</li>
<li>Easy to add test cases with setUp and tearDown functions if you wish</li>
<li>Flexible reporters for custom output, built-in support for HTML and jUnit XML</li>
<li>Allows the use of mocks and stubs</li>
</ul>
<p><strong>Contributors</strong></p>
<ul>
<li><a href="https://github.com/alexgorbatchev">alexgorbatchev</a></li>
<li><a href="https://github.com/alexkwolfe">alexkwolfe</a></li>
<li><a href="https://github.com/azatoth">azatoth</a></li>
<li><a href="https://github.com/kadirpekel">kadirpekel</a></li>
<li><a href="https://github.com/lambdalisue">lambdalisue</a></li>
<li><a href="https://github.com/luebken">luebken</a></li>
<li><a href="https://github.com/orlandov">orlandov</a></li>
<li><a href="https://github.com/Sannis">Sannis</a></li>
<li><a href="https://github.com/sstephenson">sstephenson</a></li>
<li><a href="https://github.com/thegreatape">thegreatape</a></li>
<li><a href="https://github.com/mmalecki">mmalecki</a></li>
<li>and thanks to <a href="https://github.com/cjohansen">cjohansen</a> for input and advice
on implementing setUp and tearDown functions. See
<a href="https://github.com/cjohansen/nodeunit">cjohansen&#39;s fork</a>.</li>
</ul>
<p>Also, check out gerad&#39;s <a href="https://github.com/gerad/nodeunit-dsl">nodeunit-dsl</a>
project, which implements a &#39;pretty dsl on top of nodeunit&#39;.</p>
<p>More contributor information can be found in the
<a href="https://github.com/caolan/nodeunit/blob/master/CONTRIBUTORS.md">CONTRIBUTORS.md</a>
file.</p>
<h2 id="usage">Usage</h2>
<p>Here is an example unit test module:</p>
<pre><code>exports.testSomething = function(test){
    test.expect(1);
    test.ok(true, &quot;this assertion should pass&quot;);
    test.done();
};

exports.testSomethingElse = function(test){
    test.ok(false, &quot;this assertion should fail&quot;);
    test.done();
};</code></pre>
<p>When run using the included test runner, this will output the following:</p>
<p><img src="https://github.com/caolan/nodeunit/raw/master/img/example_fail.png" /></p>
<h2 id="installation">Installation</h2>
<p>There are two options for installing nodeunit:</p>
<ol>
<li><p>Clone / download nodeunit from <a href="https://github.com/caolan/nodeunit">github</a>,
then:</p>
<p> make &amp;&amp; sudo make install</p>
</li>
<li><p>Install via npm:</p>
<p> npm install nodeunit -g</p>
</li>
</ol>
<h2 id="api-documentation">API Documentation</h2>
<p>Nodeunit uses the functions available in the node.js
<a href="http://nodejs.org/docs/v0.4.2/api/assert.html">assert module</a>:</p>
<ul>
<li><strong>ok(value, [message])</strong> - Tests if value is a true value.</li>
<li><strong>equal(actual, expected, [message])</strong> - Tests shallow, coercive equality
with the equal comparison operator ( == ).</li>
<li><strong>notEqual(actual, expected, [message])</strong> - Tests shallow, coercive
non-equality with the not equal comparison operator ( != ).</li>
<li><strong>deepEqual(actual, expected, [message])</strong> - Tests for deep equality.</li>
<li><strong>notDeepEqual(actual, expected, [message])</strong> - Tests for any deep
inequality.</li>
<li><strong>strictEqual(actual, expected, [message])</strong> - Tests strict equality, as
determined by the strict equality operator ( === )</li>
<li><strong>notStrictEqual(actual, expected, [message])</strong> - Tests strict non-equality,
as determined by the strict not equal operator ( !== )</li>
<li><strong>throws(block, [error], [message])</strong> - Expects block to throw an error.</li>
<li><strong>doesNotThrow(block, [error], [message])</strong> - Expects block not to throw an
error.</li>
<li><strong>ifError(value)</strong> - Tests if value is not a false value, throws if it is a
true value. Useful when testing the first argument, error in callbacks.</li>
</ul>
<p>Nodeunit also provides the following functions within tests:</p>
<ul>
<li><strong>expect(amount)</strong> - Specify how many assertions are expected to run within a
test. Very useful for ensuring that all your callbacks and assertions are
run.</li>
<li><strong>done()</strong> - Finish the current test function, and move on to the next. ALL
tests should call this!</li>
</ul>
<p>Nodeunit aims to be simple and easy to learn. This is achieved through using
existing structures (such as node.js modules) to maximum effect, and reducing
the API where possible, to make it easier to digest.</p>
<p>Tests are simply exported from a module, but they are still run in the order
they are defined.</p>
<p><strong>Note:</strong> Users of old nodeunit versions may remember using <code>ok</code>, <code>equals</code> and
<code>same</code> in the style of qunit, instead of the assert functions above. These
functions still exist for backwards compatibility, and are simply aliases to
their assert module counterparts.</p>
<h2 id="asynchronous-testing">Asynchronous Testing</h2>
<p>When testing asynchronous code, there are a number of sharp edges to watch out
for. Thankfully, nodeunit is designed to help you avoid as many of these
pitfalls as possible. For the most part, testing asynchronous code in nodeunit
<em>just works</em>.</p>
<h3 id="tests-run-in-series">Tests run in series</h3>
<p>While running tests in parallel seems like a good idea for speeding up your
test suite, in practice I&#39;ve found it means writing much more complicated
tests. Because of node&#39;s module cache, running tests in parallel means mocking
and stubbing is pretty much impossible. One of the nicest things about testing
in javascript is the ease of doing stubs:</p>
<pre><code>var _readFile = fs.readFile;
fs.readFile = function(path, callback){
    // it&#39;s a stub!
};
// test function that uses fs.readFile

// we&#39;re done
fs.readFile = _readFile;</code></pre>
<p>You cannot do this when running tests in parallel. In order to keep testing as
simple as possible, nodeunit avoids it. Thankfully, most unit-test suites run
fast anyway.</p>
<h3 id="explicit-ending-of-tests">Explicit ending of tests</h3>
<p>When testing async code it&#39;s important that tests end at the correct point, not
just after a given number of assertions. Otherwise your tests can run short,
ending before all assertions have completed. It&#39;s important to detect too
many assertions as well as too few. Combining explicit ending of tests with
an expected number of assertions helps to avoid false test passes, so be sure
to use the <code>test.expect()</code> method at the start of your test functions, and
<code>test.done()</code> when finished.</p>
<h2 id="groups-setup-and-teardown">Groups, setUp and tearDown</h2>
<p>Nodeunit allows the nesting of test functions:</p>
<pre><code>exports.test1 = function (test) {
    ...
}

exports.group = {
    test2: function (test) {
        ...
    },
    test3: function (test) {
        ...
    }
}</code></pre>
<p>This would be run as:</p>
<pre><code>test1
group - test2
group - test3</code></pre>
<p>Using these groups, Nodeunit allows you to define a <code>setUp</code> function, which is
run before each test, and a <code>tearDown</code> function, which is run after each test
calls <code>test.done()</code>:</p>
<pre><code>module.exports = {
    setUp: function (callback) {
        this.foo = &#39;bar&#39;;
        callback();
    },
    tearDown: function (callback) {
        // clean up
        callback();
    },
    test1: function (test) {
        test.equals(this.foo, &#39;bar&#39;);
        test.done();
    }
};</code></pre>
<p>In this way, it&#39;s possible to have multiple groups of tests in a module, each
group with its own setUp and tearDown functions.</p>
<h2 id="running-tests">Running Tests</h2>
<p>Nodeunit comes with a basic command-line test runner, which can be installed
using <code>sudo make install</code>. Example usage:</p>
<pre><code>nodeunit testmodule1.js testfolder [...]</code></pre>
<p>If no entry file specified, <code>test</code> defaults.</p>
<p>The default test reporter uses color output, because I think that&#39;s more fun :) I
intend to add a no-color option in future. To give you a feeling of the fun you&#39;ll
be having writing tests, lets fix the example at the start of the README:</p>
<p><img src="https://github.com/caolan/nodeunit/raw/master/img/example_pass.png" /></p>
<p>Ahhh, Doesn&#39;t that feel better?</p>
<p>When using the included test runner, it will exit using the failed number of
assertions as the exit code.  This means it exits with 0 when all tests pass.</p>
<h3 id="command-line-options">Command-line Options</h3>
<ul>
<li><strong>--reporter FILE</strong> - you can set the test reporter to a custom module or
on of the modules in nodeunit/lib/reporters, when omitted, the default test runner
is used.</li>
<li><strong>--list-reporters</strong> - list available built-in reporters.</li>
<li><strong>--config FILE</strong> - load config options from a JSON file, allows
the customisation of color schemes for the default test reporter etc. See
bin/nodeunit.json for current available options.</li>
<li><strong>-t testName</strong> - run specifc test only.</li>
<li><strong>-f fullTestName</strong> - run specific test only. fullTestName is built so: &quot;outerGroup - .. - innerGroup - testName&quot;.</li>
<li><strong>--version</strong> or <strong>-v</strong> - report nodeunit version</li>
<li><strong>--help</strong> - show nodeunit help</li>
</ul>
<h2 id="running-tests-in-the-browser">Running tests in the browser</h2>
<p>Nodeunit tests can also be run inside the browser. For example usage, see
the examples/browser folder. The basic syntax is as follows:</p>
<p><strong>test.html</strong></p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Example Test Suite&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;nodeunit.css&quot; type=&quot;text/css&quot; /&gt;
    &lt;script src=&quot;nodeunit.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;suite1.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;suite2.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1 id=&quot;nodeunit-header&quot;&gt;Example Test Suite&lt;/h1&gt;
    &lt;script&gt;
      nodeunit.run({
        &#39;Suite One&#39;: suite1,
        &#39;Suite Two&#39;: suite2
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Here, <code>suite1</code> and <code>suite2</code> are just object literals containing test functions
or groups, as would be returned if you did <code>require(&#39;test-suite&#39;)</code> in node.js:</p>
<p><strong>suite1.js</strong></p>
<pre><code>this.suite1 = {
    &#39;example test&#39;: function (test) {
        test.ok(true, &#39;everything is ok&#39;);
        test.done();
    }
};</code></pre>
<p>If you wish to use a commonjs format for your test suites (using exports), it is
up to you to define the commonjs tools for the browser. There are a number of
alternatives and it&#39;s important it fits with your existing code, which is
why nodeunit does not currently provide this out of the box.</p>
<p>In the example above, the tests will run when the page is loaded.</p>
<p>The browser-version of nodeunit.js is created in dist/browser when you do, <code>make
browser</code>. You&#39;ll need <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> installed in
order for it to automatically create nodeunit.min.js.</p>
<h2 id="adding-nodeunit-to-your-projects">Adding nodeunit to Your Projects</h2>
<p>If you don&#39;t want people to have to install the nodeunit command-line tool,
you&#39;ll want to create a script that runs the tests for your project with the
correct require paths set up. Here&#39;s an example test script, that assumes you
have nodeunit in a suitably located node_modules directory.</p>
<pre><code>#!/usr/bin/env node
var reporter = require(&#39;nodeunit&#39;).reporters.default;
reporter.run([&#39;test&#39;]);</code></pre>
<p>If you&#39;re using git, you might find it useful to include nodeunit as a
submodule. Using submodules makes it easy for developers to download nodeunit
and run your test suite, without cluttering up your repository with
the source code. To add nodeunit as a git submodule do the following:</p>
<pre><code>git submodule add git://github.com/caolan/nodeunit.git node_modules/nodeunit</code></pre>
<p>This will add nodeunit to the node_modules folder of your project. Now, when
cloning the repository, nodeunit can be downloaded by doing the following:</p>
<pre><code>git submodule init
git submodule update</code></pre>
<p>Let&#39;s update the test script above with a helpful hint on how to get nodeunit,
if it&#39;s missing:</p>
<pre><code>#!/usr/bin/env node
try {
    var reporter = require(&#39;nodeunit&#39;).reporters.default;
}
catch(e) {
    console.log(&quot;Cannot find nodeunit module.&quot;);
    console.log(&quot;You can download submodules for this project by doing:&quot;);
    console.log(&quot;&quot;);
    console.log(&quot;    git submodule init&quot;);
    console.log(&quot;    git submodule update&quot;);
    console.log(&quot;&quot;);
    process.exit();
}

process.chdir(__dirname);
reporter.run([&#39;test&#39;]);</code></pre>
<p>Now if someone attempts to run your test suite without nodeunit installed they
will be prompted to download the submodules for your project.</p>
<h2 id="built-in-test-reporters">Built-in Test Reporters</h2>
<ul>
<li><strong>default</strong> - The standard reporter seen in the nodeunit screenshots</li>
<li><strong>minimal</strong> - Pretty, minimal output, shows errors and progress only</li>
<li><strong>html</strong> - Outputs a HTML report to stdout</li>
<li><strong>junit</strong> - Creates jUnit compatible XML reports, which can be used with
continuous integration tools such as <a href="http://hudson-ci.org/">Hudson</a>.</li>
<li><strong>machineout</strong> - Simple reporter for machine analysis. There is
<a href="https://github.com/lambdalisue/nodeunit.vim">nodeunit.vim</a> which is useful for TDD on VIM.</li>
</ul>
<h2 id="writing-a-test-reporter">Writing a Test Reporter</h2>
<p>Nodeunit exports runTest(fn, options), runModule(mod, options) and
runFiles(paths, options). You&#39;ll most likely want to run test suites from
files, which can be done using the latter function. The <em>options</em> argument can
contain callbacks which run during testing. Nodeunit provides the following
callbacks:</p>
<ul>
<li><strong>moduleStart(name)</strong> - called before a module is tested</li>
<li><strong>moduleDone(name, assertions)</strong> - called once all test functions within the
module have completed (see assertions object reference below)
ALL tests within the module</li>
<li><strong>testStart(name)</strong> - called before a test function is run</li>
<li><strong>testReady(test)</strong> - called before a test function is run with the test object that will be passed to the test function</li>
<li><strong>testDone(name, assertions)</strong> - called once a test function has completed
(by calling test.done())</li>
<li><strong>log(assertion)</strong> - called whenever an assertion is made (see assertion
object reference below)</li>
<li><strong>done(assertions)</strong> - called after all tests/modules are complete</li>
</ul>
<p>The <strong>assertion</strong> object:</p>
<ul>
<li><strong>passed()</strong> - did the assertion pass?</li>
<li><strong>failed()</strong> - did the assertion fail?</li>
<li><strong>error</strong> - the AssertionError if the assertion failed</li>
<li><strong>method</strong> - the nodeunit assertion method used (ok, same, equals...)</li>
<li><strong>message</strong> - the message the assertion method was called with (optional)</li>
</ul>
<p>The <strong>assertionList</strong> object:</p>
<ul>
<li>An array-like object with the following new attributes:<ul>
<li><strong>failures()</strong> - the number of assertions which failed</li>
<li><strong>duration</strong> - the time taken for the test to complete in msecs</li>
</ul>
</li>
</ul>
<p>For a reference implementation of a test reporter, see lib/reporters/default.js in
the nodeunit project directory.</p>
<h2 id="sandbox-utility">Sandbox utility</h2>
<p>This is a function which evaluates JavaScript files in a sandbox and returns the
context. The sandbox function can be used for testing client-side code or private
un-exported functions within a module.</p>
<pre><code>var sandbox = require(&#39;nodeunit&#39;).utils.sandbox;
var example = sandbox(&#39;example.js&#39;);</code></pre>
<p><strong>sandbox(files, sandbox)</strong> - Evaluates JavaScript files in a sandbox, returning
the context. The first argument can either be a single filename or an array of
filenames. If multiple filenames are given their contents are concatenated before
evaluation. The second argument is an optional context to use for the sandbox.</p>
<p>Note: When working with the sandbox if your script depends on outside sources
(i.e. using <code>require</code>) then you will want to pass that into the optional
context when setting up the sandbox.</p>
<pre><code>var sandbox = require(&#39;nodeunit&#39;).utils.sandbox;
// pass in some node globals
var box_globals = {
    // Passing module.exports into the sandbox will give your code  access to it.
    module: {exports: exports},
    // Passing require into the sandbox will give your code  access to use it AND
    // will share the cache with modules already required from outside the sandbox.
    require: require,
    // Passing console into the sandbox will give your code access to it
    console: console
};
var example = sandbox(&#39;example.js&#39;, box_globals);</code></pre>
<h2 id="running-the-nodeunit-tests">Running the nodeunit Tests</h2>
<p>The tests for nodeunit are written using nodeunit itself as the test framework.
However, the module test-base.js first does some basic tests using the assert
module to ensure that test functions are actually run, and a basic level of
nodeunit functionality is available.</p>
<p>To run the nodeunit tests do:</p>
<pre><code>make test</code></pre>
<p><strong>Note:</strong> There was a bug in node v0.2.0 causing the tests to hang, upgrading
to v0.2.1 fixes this.</p>
<h2 id="__machineout__-reporter"><strong>machineout</strong> reporter</h2>
<p>The default reporter is readable for human but not for machine analysis.
When you want to analyze the output of nodeunit, use <strong>machineout</strong> reporter and you will get</p>
<p><img src="https://github.com/caolan/nodeunit/raw/master/img/example_machineout.png" /></p>
<h2 id="nodeunit-with-vim">nodeunit with vim</h2>
<p>There is <a href="https://github.com/lambdalisue/nodeunit.vim">nodeunit.vim</a> so you can use
nodeunit with VIM.</p>
<p>That compiler uses <strong>machineout</strong> reporter and it is useful to use
with <a href="https://github.com/reinh/vim-makegreen">vim-makegreen</a>.</p>
<h2 id="contributing">Contributing</h2>
<p>Contributions to the project are most welcome, so feel free to fork and improve.
When submitting a pull request, please run <code>make lint</code> first to ensure
we&#39;re following a consistent coding style.</p>

  </body>
</html>
