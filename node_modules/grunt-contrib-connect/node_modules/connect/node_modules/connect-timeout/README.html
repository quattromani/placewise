<!DOCTYPE  html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>doc</title>
    <style>
      /*github.com style (c) Vasily Polovnyov <vast@whiteants.net>*/
      pre code {
        display: block; padding: 0.5em;
        color: #333;
        background: #f8f8ff
      }
      pre .comment,
      pre .template_comment,
      pre .diff .header,
      pre .javadoc {
        color: #998;
        font-style: italic
      }
      pre .keyword,
      pre .css .rule .keyword,
      pre .winutils,
      pre .javascript .title,
      pre .nginx .title,
      pre .subst,
      pre .request,
      pre .status {
        color: #333;
        font-weight: bold
      }
      pre .number,
      pre .hexcolor,
      pre .ruby .constant {
        color: #099;
      }
      pre .string,
      pre .tag .value,
      pre .phpdoc,
      pre .tex .formula {
        color: #d14
      }
      pre .title,
      pre .id {
        color: #900;
        font-weight: bold
      }
      pre .javascript .title,
      pre .lisp .title,
      pre .clojure .title,
      pre .subst {
        font-weight: normal
      }
      pre .class .title,
      pre .haskell .type,
      pre .vhdl .literal,
      pre .tex .command {
        color: #458;
        font-weight: bold
      }
      pre .tag,
      pre .tag .title,
      pre .rules .property,
      pre .django .tag .keyword {
        color: #000080;
        font-weight: normal
      }
      pre .attribute,
      pre .variable,
      pre .lisp .body {
        color: #008080
      }
      pre .regexp {
        color: #009926
      }
      pre .class {
        color: #458;
        font-weight: bold
      }
      pre .symbol,
      pre .ruby .symbol .string,
      pre .lisp .keyword,
      pre .tex .special,
      pre .prompt {
        color: #990073
      }
      pre .built_in,
      pre .lisp .title,
      pre .clojure .built_in {
        color: #0086b3
      }
      pre .preprocessor,
      pre .pi,
      pre .doctype,
      pre .shebang,
      pre .cdata {
        color: #999;
        font-weight: bold
      }
      pre .deletion {
        background: #fdd
      }
      pre .addition {
        background: #dfd
      }
      pre .diff .change {
        background: #0086b3
      }
      pre .chunk {
        color: #aaa
      }
    </style>
  </head>
  <body>  
    <h1 id="connect-timeout">connect-timeout</h1>
<p><a href="https://npmjs.org/package/connect-timeout"><img src="https://img.shields.io/npm/v/connect-timeout.svg?style=flat" alt="NPM Version"></a>
<a href="https://npmjs.org/package/connect-timeout"><img src="https://img.shields.io/npm/dm/connect-timeout.svg?style=flat" alt="NPM Downloads"></a>
<a href="https://travis-ci.org/expressjs/timeout"><img src="https://img.shields.io/travis/expressjs/timeout.svg?style=flat" alt="Build Status"></a>
<a href="https://coveralls.io/r/expressjs/timeout?branch=master"><img src="https://img.shields.io/coveralls/expressjs/timeout.svg?style=flat" alt="Test Coverage"></a>
<a href="https://www.gratipay.com/dougwilson/"><img src="https://img.shields.io/gratipay/dougwilson.svg?style=flat" alt="Gratipay"></a></p>
<p>Times out the request in <code>ms</code>, defaulting to <code>5000</code>.</p>
<h2 id="install">Install</h2>
<pre><code class="lang-sh">$ npm install connect-timeout</code></pre>
<h2 id="api">API</h2>
<p><strong>NOTE</strong> This module is not recommend as a &quot;top-level&quot; middleware (i.e. <code>app.use(timeout(&#39;5s&#39;))</code>) unless
you take precautions to halt your own middleware processing. See <a href="#as-top-level-middleware">as top-level middleware</a>
for how to use as a top-level middleware.</p>
<h3 id="timeout-time-options-">timeout(time, options)</h3>
<p>Returns middleware that times out in <code>time</code> milliseconds. <code>time</code> can also be a string accepted by the <a href="https://www.npmjs.org/package/ms#readme">ms</a> module. On timeout, <code>req</code> will emit <code>&quot;timeout&quot;</code>.</p>
<h4 id="options">options</h4>
<ul>
<li><code>respond</code> - If <code>true</code>, the timeout error is passed to <code>next()</code> so that you may customize the response behavior. This error has a <code>.timeout</code> property as well as <code>.status == 503</code>. This defaults to <code>true</code>.</li>
</ul>
<h3 id="req-cleartimeout-">req.clearTimeout()</h3>
<p>Clears the timeout on the request.</p>
<h3 id="req-timedout">req.timedout</h3>
<p><code>true</code> if timeout fired; <code>false</code> otherwise.</p>
<h2 id="examples">Examples</h2>
<h3 id="as-top-level-middleware">as top-level middleware</h3>
<p>Because of the way middleware processing works, this once this module passes the request
to the next middleware (which it has to do in order for you to do work), it can no longer
stop the flow, so you must take care to check if the request has timedout before you
continue to act on the request.</p>
<pre><code class="lang-javascript">var express = require(&#39;express&#39;);
var timeout = require(&#39;connect-timeout&#39;);

// example of using this top-level; note the use of haltOnTimedout
// after every middleware; it will stop the request flow on a timeout
var app = express();
app.use(timeout(&#39;5s&#39;));
app.use(bodyParser());
app.use(haltOnTimedout);
app.use(cookieParser());
app.use(haltOnTimedout);

// Add your routes here, etc.

function haltOnTimedout(req, res, next){
  if (!req.timedout) next();
}

app.listen(3000);</code></pre>
<h3 id="express-3-x">express 3.x</h3>
<pre><code class="lang-javascript">var express = require(&#39;express&#39;);
var bodyParser = require(&#39;body-parser&#39;);
var timeout = require(&#39;connect-timeout&#39;);

var app = express();
app.post(&#39;/save&#39;, timeout(&#39;5s&#39;), bodyParser.json(), haltOnTimedout, function(req, res, next){
  savePost(req.body, function(err, id){
    if (err) return next(err);
    if (req.timedout) return;
    res.send(&#39;saved as id &#39; + id);
  });
});

function haltOnTimedout(req, res, next){
  if (!req.timedout) next();
}

function savePost(post, cb){
  setTimeout(function(){
    cb(null, ((Math.random()* 40000) &gt;&gt;&gt; 0));
  }, (Math.random()* 7000) &gt;&gt;&gt; 0));
}

app.listen(3000);</code></pre>
<h3 id="connect">connect</h3>
<pre><code class="lang-javascript">var bodyParser = require(&#39;body-parser&#39;);
var connect = require(&#39;connect&#39;);
var timeout = require(&#39;connect-timeout&#39;);

var app = require(&#39;connect&#39;);
app.use(&#39;/save&#39;, timeout(&#39;5s&#39;), bodyParser.json(), haltOnTimedout, function(req, res, next){
  savePost(req.body, function(err, id){
    if (err) return next(err);
    if (req.timedout) return;
    res.send(&#39;saved as id &#39; + id);
  });
});

function haltOnTimedout(req, res, next){
  if (!req.timedout) next();
}

function savePost(post, cb){
  setTimeout(function(){
    cb(null, ((Math.random()* 40000) &gt;&gt;&gt; 0));
  }, (Math.random()* 7000) &gt;&gt;&gt; 0));
}

app.listen(3000);</code></pre>
<h2 id="license">License</h2>
<p><a href="LICENSE">MIT</a></p>

  </body>
</html>
