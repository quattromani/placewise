<!DOCTYPE  html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>doc</title>
    <style>
      /*github.com style (c) Vasily Polovnyov <vast@whiteants.net>*/
      pre code {
        display: block; padding: 0.5em;
        color: #333;
        background: #f8f8ff
      }
      pre .comment,
      pre .template_comment,
      pre .diff .header,
      pre .javadoc {
        color: #998;
        font-style: italic
      }
      pre .keyword,
      pre .css .rule .keyword,
      pre .winutils,
      pre .javascript .title,
      pre .nginx .title,
      pre .subst,
      pre .request,
      pre .status {
        color: #333;
        font-weight: bold
      }
      pre .number,
      pre .hexcolor,
      pre .ruby .constant {
        color: #099;
      }
      pre .string,
      pre .tag .value,
      pre .phpdoc,
      pre .tex .formula {
        color: #d14
      }
      pre .title,
      pre .id {
        color: #900;
        font-weight: bold
      }
      pre .javascript .title,
      pre .lisp .title,
      pre .clojure .title,
      pre .subst {
        font-weight: normal
      }
      pre .class .title,
      pre .haskell .type,
      pre .vhdl .literal,
      pre .tex .command {
        color: #458;
        font-weight: bold
      }
      pre .tag,
      pre .tag .title,
      pre .rules .property,
      pre .django .tag .keyword {
        color: #000080;
        font-weight: normal
      }
      pre .attribute,
      pre .variable,
      pre .lisp .body {
        color: #008080
      }
      pre .regexp {
        color: #009926
      }
      pre .class {
        color: #458;
        font-weight: bold
      }
      pre .symbol,
      pre .ruby .symbol .string,
      pre .lisp .keyword,
      pre .tex .special,
      pre .prompt {
        color: #990073
      }
      pre .built_in,
      pre .lisp .title,
      pre .clojure .built_in {
        color: #0086b3
      }
      pre .preprocessor,
      pre .pi,
      pre .doctype,
      pre .shebang,
      pre .cdata {
        color: #999;
        font-weight: bold
      }
      pre .deletion {
        background: #fdd
      }
      pre .addition {
        background: #dfd
      }
      pre .diff .change {
        background: #0086b3
      }
      pre .chunk {
        color: #aaa
      }
    </style>
  </head>
  <body>  
    <h1 id="express-session">express-session</h1>
<p><a href="https://npmjs.org/package/express-session"><img src="https://img.shields.io/npm/v/express-session.svg?style=flat" alt="NPM Version"></a>
<a href="https://npmjs.org/package/express-session"><img src="https://img.shields.io/npm/dm/express-session.svg?style=flat" alt="NPM Downloads"></a>
<a href="https://travis-ci.org/expressjs/session"><img src="https://img.shields.io/travis/expressjs/session.svg?style=flat" alt="Build Status"></a>
<a href="https://coveralls.io/r/expressjs/session?branch=master"><img src="https://img.shields.io/coveralls/expressjs/session.svg?style=flat" alt="Test Coverage"></a>
<a href="https://gratipay.com/dougwilson/"><img src="https://img.shields.io/gratipay/dougwilson.svg?style=flat" alt="Gratipay"></a></p>
<h2 id="installation">Installation</h2>
<pre><code class="lang-bash">$ npm install express-session</code></pre>
<h2 id="api">API</h2>
<pre><code class="lang-js">var express = require(&#39;express&#39;)
var session = require(&#39;express-session&#39;)

var app = express()

app.use(session({
  secret: &#39;keyboard cat&#39;,
  resave: false,
  saveUninitialized: true
}))</code></pre>
<h3 id="session-options-">session(options)</h3>
<p>Setup session store with the given <code>options</code>.</p>
<p>Session data is <em>not</em> saved in the cookie itself, just the session ID.</p>
<h4 id="options">Options</h4>
<ul>
<li><code>name</code> - cookie name (formerly known as <code>key</code>). (default: <code>&#39;connect.sid&#39;</code>)</li>
<li><code>store</code> - session store instance.</li>
<li><code>secret</code> - session cookie is signed with this secret to prevent tampering.</li>
<li><code>cookie</code> - session cookie settings.<ul>
<li>(default: <code>{ path: &#39;/&#39;, httpOnly: true, secure: false, maxAge: null }</code>)</li>
</ul>
</li>
<li><code>genid</code> - function to call to generate a new session ID. (default: uses <code>uid2</code> library)</li>
<li><code>rolling</code> - forces a cookie set on every response. This resets the expiration date. (default: <code>false</code>)</li>
<li><code>resave</code> - forces session to be saved even when unmodified. (default: <code>true</code>, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case. Typically, you&#39;ll want <code>false</code>)</li>
<li><code>proxy</code> - trust the reverse proxy when setting secure cookies (via &quot;x-forwarded-proto&quot; header). When set to <code>true</code>, the &quot;x-forwarded-proto&quot; header will be used. When set to <code>false</code>, all headers are ignored. When left unset, will use the &quot;trust proxy&quot; setting from express. (default: <code>undefined</code>)</li>
<li><code>saveUninitialized</code> - forces a session that is &quot;uninitialized&quot; to be saved to the store. A session is uninitialized when it is new but not modified. (default: <code>true</code>, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case)</li>
<li><code>unset</code> - controls result of unsetting <code>req.session</code> (through <code>delete</code>, setting to <code>null</code>, etc.). This can be &quot;keep&quot; to keep the session in the store but ignore modifications or &quot;destroy&quot; to destroy the stored session. (default: <code>&#39;keep&#39;</code>)</li>
</ul>
<h4 id="options-genid">options.genid</h4>
<p>Generate a custom session ID for new sessions. Provide a function that returns a string that will be used as a session ID. The function is given <code>req</code> as the first argument if you want to use some value attached to <code>req</code> when generating the ID.</p>
<p><strong>NOTE</strong> be careful you generate unique IDs so your sessions do not conflict.</p>
<pre><code class="lang-js">app.use(session({
  genid: function(req) {
    return genuuid(); // use UUIDs for session IDs
  },
  secret: &#39;keyboard cat&#39;
}))</code></pre>
<h4 id="options-resave">options.resave</h4>
<p>Forces the session to be saved back to the session store, even if the session was never modified during the request. Depending on your store this may be necessary, but it can also create race conditions where a client has two parallel requests to your server and changes made to the session in one request may get overwritten when the other request ends, even if it made no changes (this behavior also depends on what store you&#39;re using).</p>
<h4 id="options-saveuninitialized">options.saveUninitialized</h4>
<p>Forces a session that is &quot;uninitialized&quot; to be saved to the store. A session is uninitialized when it is new but not modified. Choosing <code>false</code> is useful for implementing login sessions, reducing server storage usage, or complying with laws that require permission before setting a cookie. Choose <code>false</code> will also help with race conditions where a client makes multiple parallel requests without a session.</p>
<h4 id="cookie-options">Cookie options</h4>
<p>Please note that <code>secure: true</code> is a <strong>recommended</strong> option. However, it requires an https-enabled website, i.e., HTTPS is necessary for secure cookies.
If <code>secure</code> is set, and you access your site over HTTP, the cookie will not be set. If you have your node.js behind a proxy and are using <code>secure: true</code>, you need to set &quot;trust proxy&quot; in express:</p>
<pre><code class="lang-js">var app = express()
app.set(&#39;trust proxy&#39;, 1) // trust first proxy
app.use(session({
  secret: &#39;keyboard cat&#39;,
  resave: false,
  saveUninitialized: true,
  cookie: { secure: true }
}))</code></pre>
<p>For using secure cookies in production, but allowing for testing in development, the following is an example of enabling this setup based on <code>NODE_ENV</code> in express:</p>
<pre><code class="lang-js">var app = express()
var sess = {
  secret: &#39;keyboard cat&#39;,
  cookie: {}
}

if (app.get(&#39;env&#39;) === &#39;production&#39;) {
  app.set(&#39;trust proxy&#39;, 1) // trust first proxy
  sess.cookie.secure = true // serve secure cookies
}

app.use(session(sess))</code></pre>
<p>By default <code>cookie.maxAge</code> is <code>null</code>, meaning no &quot;expires&quot; parameter is set
so the cookie becomes a browser-session cookie. When the user closes the
browser the cookie (and session) will be removed.</p>
<h3 id="req-session">req.session</h3>
<p>To store or access session data, simply use the request property <code>req.session</code>,
which is (generally) serialized as JSON by the store, so nested objects
are typically fine. For example below is a user-specific view counter:</p>
<pre><code class="lang-js">app.use(session({ secret: &#39;keyboard cat&#39;, cookie: { maxAge: 60000 }}))

app.use(function(req, res, next) {
  var sess = req.session
  if (sess.views) {
    sess.views++
    res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;)
    res.write(&#39;&lt;p&gt;views: &#39; + sess.views + &#39;&lt;/p&gt;&#39;)
    res.write(&#39;&lt;p&gt;expires in: &#39; + (sess.cookie.maxAge / 1000) + &#39;s&lt;/p&gt;&#39;)
    res.end()
  } else {
    sess.views = 1
    res.end(&#39;welcome to the session demo. refresh!&#39;)
  }
})</code></pre>
<h4 id="session-regenerate-">Session.regenerate()</h4>
<p>To regenerate the session simply invoke the method, once complete
a new SID and <code>Session</code> instance will be initialized at <code>req.session</code>.</p>
<pre><code class="lang-js">req.session.regenerate(function(err) {
  // will have a new session here
})</code></pre>
<h4 id="session-destroy-">Session.destroy()</h4>
<p>Destroys the session, removing <code>req.session</code>, will be re-generated next request.</p>
<pre><code class="lang-js">req.session.destroy(function(err) {
  // cannot access session here
})</code></pre>
<h4 id="session-reload-">Session.reload()</h4>
<p>Reloads the session data.</p>
<pre><code class="lang-js">req.session.reload(function(err) {
  // session updated
})</code></pre>
<h4 id="session-save-">Session.save()</h4>
<pre><code class="lang-js">req.session.save(function(err) {
  // session saved
})</code></pre>
<h4 id="session-touch-">Session.touch()</h4>
<p>Updates the <code>.maxAge</code> property. Typically this is
not necessary to call, as the session middleware does this for you.</p>
<h3 id="req-session-cookie">req.session.cookie</h3>
<p>Each session has a unique cookie object accompany it. This allows
you to alter the session cookie per visitor. For example we can
set <code>req.session.cookie.expires</code> to <code>false</code> to enable the cookie
to remain for only the duration of the user-agent.</p>
<h4 id="cookie-maxage">Cookie.maxAge</h4>
<p>Alternatively <code>req.session.cookie.maxAge</code> will return the time
remaining in milliseconds, which we may also re-assign a new value
to adjust the <code>.expires</code> property appropriately. The following
are essentially equivalent</p>
<pre><code class="lang-js">var hour = 3600000
req.session.cookie.expires = new Date(Date.now() + hour)
req.session.cookie.maxAge = hour</code></pre>
<p>For example when <code>maxAge</code> is set to <code>60000</code> (one minute), and 30 seconds
has elapsed it will return <code>30000</code> until the current request has completed,
at which time <code>req.session.touch()</code> is called to reset <code>req.session.maxAge</code>
to its original value.</p>
<pre><code class="lang-js">req.session.cookie.maxAge // =&gt; 30000</code></pre>
<h2 id="session-store-implementation">Session Store Implementation</h2>
<p>Every session store <em>must</em> implement the following methods</p>
<ul>
<li><code>.get(sid, callback)</code></li>
<li><code>.set(sid, session, callback)</code></li>
<li><code>.destroy(sid, callback)</code></li>
</ul>
<p>Recommended methods include, but are not limited to:</p>
<ul>
<li><code>.length(callback)</code></li>
<li><code>.clear(callback)</code></li>
</ul>
<p>For an example implementation view the <a href="http://github.com/visionmedia/connect-redis">connect-redis</a> repo.</p>
<h2 id="license">License</h2>
<p><a href="LICENSE">MIT</a></p>

  </body>
</html>
